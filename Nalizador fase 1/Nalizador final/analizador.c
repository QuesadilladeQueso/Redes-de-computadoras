#include <stdio.h>

void analiza(unsigned char []);
unsigned char S[][5]={"RR","RNR","REJ","SREJ"};
unsigned char MC[][6]={"UI","SIM","","SARM","UP","","","SABM","DISC","","","SARME","","","","SABME",
					   "SNRM","","","RSET","","","","XID","","","","SNRME","","","","SNRM"};
unsigned char MR[][5]={"UI","RIM","","DM","","","","","RD","","","","UA","TEST","","",""
							"","FRMR","","","","","","XID","","","","","TEST","","",""};
unsigned char T[][200]={{ //t1
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x08, 0x06, 0x00, 0x10,
0x08, 0x00, 0x06, 0x04, 0x00, 0x04, 0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x94, 0xcc, 0x39, 0xcb,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x94, 0xcc, 0x39, 0xfe                                 
},
{  //t2
0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x08, 0x00, 0x46, 0x00, 
0x80, 0x42, 0x04, 0x55, 0x34, 0x11, 0x80, 0x11, 0x6b, 0xf0, 0x94, 0xcc, 0x39, 0xcb, 0x94, 0xcc, 
0x67, 0x02, 0xaa, 0xbb, 0xcc, 0xdd, 0x04, 0x0c, 0x00, 0x35, 0x00, 0x2e, 0x85, 0x7c, 0xe2, 0x1a, 
0x01, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x77, 0x77, 0x77, 0x03, 0x69, 
0x73, 0x63, 0x05, 0x65, 0x73, 0x63, 0x6f, 0x6d, 0x03, 0x69, 0x70, 0x6e, 0x02, 0x6d, 0x78, 0x00, 
0x00, 0x1c, 0x00, 0x01                          
},
{  //t3
0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x04, 0xf0, 0xf1, 
0x09, 0x8d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x9b, 0x6d  
},

{  //t4
0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x80, 0x35, 0x00, 0x01, 
0x08, 0x00, 0x06, 0x04, 0x00, 0x03, 0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x94, 0xcc, 0x3a, 0xe1, 
0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x94, 0xcc, 0x39, 0xcb, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd8, 0xee, 0xdf, 0xb0  
},
{ //t5
0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x03, 0xf0, 0xf0, 
0x53, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x43, 0x05, 0x90, 0x6d  
},

{  //T6
0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x12, 0xf0, 0xf0, 
0x0a, 0x0b, 0x0e, 0x00, 0xff, 0xef, 0x14, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x7f, 0x23,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x99, 0x98, 0x6d  
},
{ //t7
0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x03, 0xf0, 0xf1, 
0x53, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x43, 0x05, 0x90, 0x6d  
},
{ //t8
0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x03, 0xf0, 0xf0, 
0x43, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x43, 0x05, 0x90, 0x6d  
}
};
unsigned short int ToT;
unsigned char i;

int main(){
 	unsigned char respuesta;
 	unsigned char opc1;
	do{
		printf("Isaac Baruch Ortiz Meraz\n");
		printf("Cuantas tramas se analizaran?\n");
		scanf("%d", &opc1);
		for(i=0;i<opc1;i++){
			printf("\nTRAMA %d \n", i+1);
			printf("----------------------------------\n");
			analiza(T[i]);
			printf("----------------------------------\n");
		}
		printf("Desea volver a hacerlo? (s/n)\n");
		fflush(stdin);
	   	scanf("%s", &respuesta);
	}while (respuesta != 'n');
}


void analiza(unsigned char T[]){

	ToT = (T[12]<<8|T[13]);

	printf("^o^----Cabecera Ethernet----^o^\n");
	printf("MAC Destino: %.2x : %.2x : %.2x : %.2x : %.2x : %.2x\n", T[0], T[1], T[2], T[3], T[4], T[5]);
	printf("MAC Origen: %.2x : %.2x : %.2x : %.2x : %.2x : %.2x\n", T[6], T[7], T[8], T[9], T[10], T[11]);

	if(ToT <= 1500){
		printf("Tama%co: %d bytes\n",164, ToT);
		printf("----Cabecera LLC\n\n");
		switch (T[16]&3)
		{
			case 0:
				printf("T-I, N(s)=%d, N(r)=%d, ", T[16]>>1, T[17]>>1);
				if(T[17]&1){
					if(T[15]&1)
						printf("F\n");
					else
						printf("P\n");
				}
				break;
			case 1:
				printf("T-S, %s, N(r)=%d, ", S[(T[16]>>2)&3], T[17]>>1);
				if(T[17]&1){
					if(T[15]&1)
						printf("F\n");
					else
						printf("P\n");
				}
				break;
			case 2:
				printf("T-I, N(s)=%d, N(r)=%d, ", T[16]>>1, T[17]>>1);
				if(T[17]&1){
					if(T[15]&1)
						printf("F\n");
					else
						printf("P\n");
				}
				break;
			case 3:
				printf("T-U, ");
				if(T[16]&16){
					if(T[15]&1)
						printf("%s\n", MR[((T[16]>>2)&3)|((T[16]>>3)&28)]);
					else
						printf("%s\n", MC[((T[16]>>2)&3)|((T[16]>>3)&28)]);

						if (((T[16]>>2)&3)|(((T[16]>>3)&28)==11) || (((T[16]>>2)&3)|(((T[16]>>3)&28)==15)) | ((T[16]>>2)&3)|((T[16]>>3)&28)==27)
							printf("\n");
				}
				break;
		}
			}else{
				if(ToT <= 2048){
					printf("Tipo IP: %d bytes\n", ToT);
					printf("----Cabecera IP\n\n");
						}else{
				if(ToT <= 2054){
					printf("Tipo ARP: %d bytes\n", ToT);
					printf("----Cabecera ARP\n\n");
						}else{
				printf("Tipo otro: %d bytes\n", ToT);
				printf("----Cabecera Otro\n\n");
			}
		}
	}

}

